config OBJZ
    bool "Objective-C support"
    select STATIC_INIT_GNU
    select THREAD_LOCAL_STORAGE
    default n
    help
      Enable Objective-C language support in Zephyr.

      This option enables the Objective-C compiler and related tools,
      allowing you to write and compile Objective-C code within the Zephyr
      RTOS environment. Includes retain/release/autorelease memory
      management and per-thread autorelease pool stack.

      Note: Enabling Objective-C support may increase the size of the
      compiled binaries and could impact performance.

if OBJZ

config OBJZ_BOOT_BANNER
    bool "Objective-Z boot banner"
    default y
    help
      Print a boot banner at runtime initialization.
      The banner includes the module name and version number.

config OBJZ_BOOT_BANNER_STRING
    string "Boot banner string"
    depends on OBJZ_BOOT_BANNER
    default "Objective-Z Runtime"
    help
      The string printed in the boot banner. The version number
      is appended automatically.

config OBJZ_BLOCKS
    bool "Blocks (closures) support"
    default n
    help
      Enable Objective-C/C blocks runtime. Provides _Block_copy,
      _Block_release and related functions needed by Clang -fblocks.
      When enabled, .m files are compiled with -fblocks.

config OBJZ_STATIC_POOLS
    bool "Static allocation pools for ObjC classes"
    default n
    help
      Enable per-class static memory pools using K_MEM_SLAB.
      Use OZ_DEFINE_POOL(ClassName, block_size, count, align)
      in application code to declare pools. Classes without a
      pool fall back to the sys_heap allocator.

config OBJZ_STATIC_POOL_TABLE_SIZE
    int "Maximum number of static pool registrations"
    depends on OBJZ_STATIC_POOLS
    default 0
    help
      Maximum number of OZ_DEFINE_POOL registrations.
      0 = auto-computed from AST analysis.

config OBJZ_COLLECTIONS
    bool "Foundation collection classes (OZArray, OZDictionary)"
    help
      Enable OZArray and OZDictionary with NSFastEnumeration.

config OBJZ_NUMBERS
    bool "Foundation number class (OZNumber)"
    help
      Enable OZNumber for boxed numeric values.

config OBJZ_LITERALS
    bool "ObjC boxed literals and collection literals"
    depends on OBJZ_COLLECTIONS && OBJZ_NUMBERS
    help
      Enable @42, @YES, @3.14, @[...], and @{k:v} literal syntax.
      Requires both collection and number classes.

config OBJZ_LOG_BUFFER_SIZE
    int "OZLog format buffer size"
    default 128
    help
      Size of the stack buffer used by OZLog() for formatting.
      Messages longer than this are truncated.

config OBJZ_MEM_POOL_SIZE
    int "Objective-Z memory heap pool size"
    default 4096

config OBJZ_MEMORY_POOL_CUSTOM_SECTION
    bool "Objective-Z heap memory custom section"

config OBJZ_MEMORY_POOL_ZEPHYR_REGION
    bool "Objective-Z heap memory region"

config OBJZ_MEMORY_POOL_ZEPHYR_REGION_NAME
    string "Objective-Z heap memory region name"

config OBJZ_CLASS_TABLE_SIZE
    int "Class table size"
    default 0
    help
      Maximum number of Objective-C classes that can be registered.
      0 = auto-computed from AST analysis.

config OBJZ_CATEGORY_TABLE_SIZE
    int "Category table size"
    default 0
    help
      Maximum number of Objective-C categories that can be registered.
      0 = auto-computed from AST analysis.

config OBJZ_PROTOCOL_TABLE_SIZE
    int "Protocol table size"
    default 0
    help
      Maximum number of Objective-C protocols that can be registered.
      0 = auto-computed from AST analysis.

config OBJZ_HASH_TABLE_SIZE
    int "Method hash table size"
    default 0
    help
      Size of the global method hash table. Uses open addressing
      for collision resolution.
      0 = auto-computed from AST analysis.

config OBJZ_DISPATCH_CACHE
    bool "Per-class dispatch table cache"
    default y
    help
      Enable per-class method dispatch caching. On first message
      send the resolved IMP is cached in the receiver class dtable
      for O(1) subsequent lookups using pointer hashing. Static
      pool in BSS serves the first N classes; overflow falls back
      to the sys_heap allocator.

config OBJZ_DISPATCH_TABLE_SIZE
    int "Dispatch table entries per class"
    depends on OBJZ_DISPATCH_CACHE
    default 0
    help
      Number of cache entries per class dispatch table. Must be a
      power of 2. Each entry costs 8 bytes (ARM32). Memory per
      class = size * 8 bytes. Typical: 8 (64B), 16 (128B), 32 (256B).
      0 = auto-computed from AST analysis.

config OBJZ_DISPATCH_CACHE_STATIC_COUNT
    int "Number of static dispatch table blocks"
    depends on OBJZ_DISPATCH_CACHE
    default 0
    help
      Number of per-class dispatch tables pre-allocated in BSS.
      First N classes get a dtable from this pool with zero heap
      cost. Additional classes fall back to objc_malloc().
      Total BSS = count * DISPATCH_TABLE_SIZE * 8 bytes.
      0 = auto-computed from AST analysis.

module = OBJZ
module-str = objz
source "subsys/logging/Kconfig.template.log_config"

endif
