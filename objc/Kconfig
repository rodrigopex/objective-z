config OBJZ
    bool "Objective-C support"
    select STATIC_INIT_GNU
    select THREAD_LOCAL_STORAGE
    default n
    help
      Enable Objective-C language support in Zephyr.

      This option enables the Objective-C compiler and related tools,
      allowing you to write and compile Objective-C code within the Zephyr
      RTOS environment. Includes retain/release/autorelease memory
      management and per-thread autorelease pool stack.

      Note: Enabling Objective-C support may increase the size of the
      compiled binaries and could impact performance.

if OBJZ

config OBJZ_ARC
    bool "ARC (Automatic Reference Counting) support"
    default n
    help
      Enable ARC entry points (objc_retain, objc_release,
      objc_storeStrong, etc.).
      Use objz_compile_objc_arc_sources() or
      objz_target_arc_sources() in CMake to compile .m files
      with -fobjc-arc.

config OBJZ_STATIC_POOLS
    bool "Static allocation pools for ObjC classes"
    default n
    help
      Enable per-class static memory pools using K_MEM_SLAB.
      Use OZ_DEFINE_POOL(ClassName, block_size, count, align)
      in application code to declare pools. Classes without a
      pool fall back to the sys_heap allocator.

config OBJZ_STATIC_POOL_TABLE_SIZE
    int "Maximum number of static pool registrations"
    depends on OBJZ_STATIC_POOLS
    default 16
    help
      Maximum number of OZ_DEFINE_POOL registrations.

config OBJZ_LITERALS
    bool "ObjC boxed literals and collection literals"
    help
      Enable OZNumber (@42, @YES, @3.14), OZArray (@[...]),
      and OZDictionary (@{k:v}) literal classes.

config OBJZ_LOG_BUFFER_SIZE
    int "OZLog format buffer size"
    default 128
    help
      Size of the stack buffer used by OZLog() for formatting.
      Messages longer than this are truncated.

config OBJZ_MEM_POOL_SIZE
    int "Objective-Z memory heap pool size"
    default 4096

config OBJZ_MEMORY_POOL_CUSTOM_SECTION
    bool "Objective-Z heap memory custom section"

config OBJZ_MEMORY_POOL_ZEPHYR_REGION
    bool "Objective-Z heap memory region"

config OBJZ_MEMORY_POOL_ZEPHYR_REGION_NAME
    string "Objective-Z heap memory region name"

config OBJZ_CLASS_TABLE_SIZE
    int "Class table size"
    default 32
    help
      Maximum number of Objective-C classes that can be registered.

config OBJZ_CATEGORY_TABLE_SIZE
    int "Category table size"
    default 32
    help
      Maximum number of Objective-C categories that can be registered.

config OBJZ_PROTOCOL_TABLE_SIZE
    int "Protocol table size"
    default 32
    help
      Maximum number of Objective-C protocols that can be registered.

config OBJZ_HASH_TABLE_SIZE
    int "Method hash table size"
    default 512
    help
      Size of the global method hash table. Uses open addressing
      for collision resolution.

config OBJZ_DISPATCH_CACHE
    bool "Per-class dispatch table cache"
    default y
    help
      Enable per-class method dispatch caching. On first message
      send the resolved IMP is cached in the receiver class dtable
      for O(1) subsequent lookups using pointer hashing. Static
      pool in BSS serves the first N classes; overflow falls back
      to the sys_heap allocator.

config OBJZ_DISPATCH_TABLE_SIZE
    int "Dispatch table entries per class"
    depends on OBJZ_DISPATCH_CACHE
    default 16
    help
      Number of cache entries per class dispatch table. Must be a
      power of 2. Each entry costs 8 bytes (ARM32). Memory per
      class = size * 8 bytes. Typical: 8 (64B), 16 (128B), 32 (256B).

config OBJZ_DISPATCH_CACHE_STATIC_COUNT
    int "Number of static dispatch table blocks"
    depends on OBJZ_DISPATCH_CACHE
    default 8
    help
      Number of per-class dispatch tables pre-allocated in BSS.
      First N classes get a dtable from this pool with zero heap
      cost. Additional classes fall back to objc_malloc().
      Total BSS = count * DISPATCH_TABLE_SIZE * 8 bytes.

module = OBJZ
module-str = objz
source "subsys/logging/Kconfig.template.log_config"

endif
